# 缓冲编辑器（强制置顶）

一个功能丰富的多标签页文本编辑器，具有强制置顶、图片支持、项目管理等特性。

## 🚀 主要特性

### 核心功能
- **强制置顶窗口**：始终保持在其他窗口之上，方便随时记录
- **多标签页管理**：支持多个文档同时编辑，书签式标签页设计
- **项目统一管理**：支持多标签页项目的统一保存和加载
- **富文本支持**：支持图片嵌入、文字颜色、背景颜色等格式化功能
- **自定义界面**：完全自定义的标题栏、菜单栏和窗口边框

### 文件格式支持
- **纯文本文件**：`.txt`、`.py` 等常见文本格式
- **富文本文件**：`.rted` 格式，支持图片和格式信息
- **项目文件**：`.rtep` 格式，包含多个标签页的完整项目

### 图片功能
- **嵌入式图片**：直接插入到文本中的图片
- **浮动图片**：可自由拖拽定位的独立图片
- **图片拖拽**：支持图片的拖拽移动和位置调整
- **右键菜单**：图片的删除、拖拽开关等操作

## 🎯 界面设计

### 窗口布局
```
┌─────────────────────────────────────────────────────────┐
│ 自定义标题栏 [最小化] [最大化] [关闭]                      │
├─────────────────────────────────────────────────────────┤
│ 菜单栏: [文件] [编辑] [插入] [格式] [查看]                │
├─────┬───────────────────────────────────────────────────┤
│ 标  │                                                 │
│ 签  │              文本编辑区域                        │
│ 页  │                                                 │
│ 面  │                                                 │
│ 板  │                                                 │
│ [+] │                                                 │
├─────┴───────────────────────────────────────────────────┤
│ 状态栏: 行: 1 | 列: 0                                   │
└─────────────────────────────────────────────────────────┘
```

### 颜色主题
- **背景色**：`#A0A0A0` (灰色主题)
- **文字色**：`#3D2914` (深褐色)
- **统一配色**：所有UI组件采用一致的配色方案

## 📋 功能详解

### 1. 标签页管理

#### 标签页操作
- **新建标签页**：点击 `+` 按钮或使用快捷键
- **切换标签页**：点击书签式标签页按钮
- **关闭标签页**：右键菜单选择关闭
- **重命名标签页**：右键菜单选择重命名
- **自定义颜色**：为标签页设置个性化颜色

#### 标签页状态
- 自动保存每个标签页的内容、光标位置、修改状态
- 支持标签页间的独立撤销/重做操作
- 智能的修改状态跟踪和显示

### 2. 文件操作

#### 单文件操作
- **新建文件** (`Ctrl+N`)：创建新的标签页
- **打开文件** (`Ctrl+O`)：支持 `.txt`、`.py`、`.rted`、`.rtep` 格式
- **保存文件** (`Ctrl+S`)：保存当前标签页
- **另存为** (`Ctrl+Shift+S`)：将当前标签页另存为新文件

#### 项目操作
- **保存项目** (`Ctrl+Shift+P`)：将所有标签页保存为 `.rtep` 项目文件
- **项目另存为**：将当前项目另存为新的项目文件
- **打开项目** (`Ctrl+Shift+O`)：加载 `.rtep` 项目文件，恢复所有标签页

### 3. 编辑功能

#### 基础编辑
- **撤销/重做** (`Ctrl+Z`/`Ctrl+Y`)：支持多级撤销重做
- **剪切/复制/粘贴** (`Ctrl+X`/`Ctrl+C`/`Ctrl+V`)：标准剪贴板操作
- **查找** (`Ctrl+F`)：文本查找功能

#### 格式化
- **文字颜色**：自定义文字颜色
- **背景颜色**：自定义背景颜色
- **字体选择**：更改字体类型和大小

### 4. 图片功能

#### 图片插入
- 支持常见图片格式（PNG、JPG、GIF等）
- 自动调整图片大小以适应编辑器
- 两种插入模式：嵌入式和浮动式

#### 图片操作
- **拖拽移动**：启用拖拽后可自由移动图片位置
- **右键菜单**：删除图片、切换拖拽状态
- **位置保存**：图片位置信息会随文件保存

### 5. 界面定制

#### 显示选项
- **行号显示**：可切换显示/隐藏行号
- **透明度控制**：调整窗口透明度
- **窗口大小调整**：支持边缘拖拽调整窗口大小

#### 窗口控制
- **强制置顶**：始终保持在最前端
- **最小化/最大化**：标准窗口操作
- **自定义标题栏**：无系统边框的现代化界面

## 🔧 技术实现

### 核心技术栈
- **GUI框架**：Tkinter (Python标准库)
- **图片处理**：PIL/Pillow (可选依赖)
- **数据存储**：JSON格式，支持Base64图片编码
- **窗口管理**：Windows API集成 (可选)

### 架构设计

#### 主要类结构
```python
class TopMostEditor:
    # 核心属性
    - tabs[]                 # 标签页列表
    - current_tab_index      # 当前标签页索引
    - project_filename       # 项目文件路径
    - floating_images{}      # 浮动图片管理
    
    # 核心方法
    - setup_ui()            # 界面初始化
    - create_new_tab()      # 创建新标签页
    - switch_to_tab()       # 切换标签页
    - save_project()        # 保存项目
    - import_project_data() # 导入项目数据
```

#### 数据结构

**标签页数据结构**：
```json
{
    "id": 1,
    "title": "标签页标题",
    "filename": "关联文件路径",
    "content": "文本内容",
    "images": [],
    "image_info": {},
    "modified": false,
    "cursor_pos": "1.0",
    "custom_color": "#颜色值"
}
```

**项目文件格式** (`.rtep`)：
```json
{
    "version": "1.0",
    "project_name": "项目名称",
    "created_time": "2024-01-01T00:00:00",
    "modified_time": "2024-01-01T00:00:00",
    "current_tab_index": 0,
    "tabs": [标签页数据列表]
}
```

### 关键特性实现

#### 1. 强制置顶
```python
self.root.attributes('-topmost', True)
```

#### 2. 自定义窗口
```python
self.root.overrideredirect(True)  # 移除系统标题栏
# 自定义标题栏、边框、调整大小区域
```

#### 3. 图片Base64存储
```python
# 保存时转换为Base64
buffer = BytesIO()
image.save(buffer, format='PNG')
image_base64 = base64.b64encode(buffer.getvalue()).decode('utf-8')

# 加载时从Base64恢复
image_bytes = base64.b64decode(image_base64)
image = Image.open(BytesIO(image_bytes))
```

#### 4. 标签页状态管理
```python
def save_current_tab_state(self):
    """保存当前标签页状态"""
    # 保存文本内容、光标位置、修改状态、图片信息
    
def load_tab_content(self, tab_data):
    """加载标签页内容"""
    # 恢复文本内容、光标位置、图片显示
```

## 📦 依赖要求

### 必需依赖
- **Python 3.6+**
- **Tkinter** (通常随Python安装)

### 可选依赖
- **Pillow (PIL)**：图片功能支持
  ```bash
  pip install Pillow
  ```
- **ctypes** (Windows)：Windows API集成

### 安装说明
1. 确保Python环境已安装
2. 安装Pillow以启用图片功能：
   ```bash
   pip install Pillow
   ```
3. 直接运行 `main.py`：
   ```bash
   python main.py
   ```

## 🎮 使用指南

### 快速开始
1. **启动程序**：运行 `python main.py`
2. **创建内容**：在默认标签页中输入文本
3. **添加标签页**：点击 `+` 按钮创建新标签页
4. **保存项目**：使用 `Ctrl+Shift+P` 保存整个项目

### 常用操作

#### 文本编辑
- 直接在编辑器中输入文本
- 使用标准快捷键进行编辑操作
- 通过格式菜单调整文字和背景颜色

#### 图片操作
1. **插入图片**：插入菜单 → 插入图片
2. **移动图片**：右键图片 → 启用拖动 → 拖拽到目标位置
3. **删除图片**：右键图片 → 删除图片

#### 项目管理
1. **创建项目**：添加多个标签页，编辑内容
2. **保存项目**：文件菜单 → 保存项目 (或 `Ctrl+Shift+P`)
3. **加载项目**：文件菜单 → 打开项目 (或 `Ctrl+Shift+O`)

### 快捷键列表

| 功能 | 快捷键 |
|------|--------|
| 新建文件 | `Ctrl+N` |
| 打开文件 | `Ctrl+O` |
| 保存文件 | `Ctrl+S` |
| 另存为 | `Ctrl+Shift+S` |
| 保存项目 | `Ctrl+Shift+P` |
| 打开项目 | `Ctrl+Shift+O` |
| 查找 | `Ctrl+F` |
| 退出 | `Ctrl+Q` |
| 撤销 | `Ctrl+Z` |
| 重做 | `Ctrl+Y` |
| 剪切 | `Ctrl+X` |
| 复制 | `Ctrl+C` |
| 粘贴 | `Ctrl+V` |

## 🔍 高级功能

### 语法高亮
- 支持Python代码的基础语法高亮
- 关键字、字符串、注释、函数名等不同颜色显示

### 行号显示
- 内嵌式行号显示
- 可通过查看菜单切换显示/隐藏
- 智能更新，跟随文本变化

### 透明度控制
- 支持窗口透明度调整
- 通过查看菜单访问透明度控制面板
- 实时预览透明度效果

### 窗口管理
- **拖拽移动**：通过标题栏拖拽窗口
- **边缘调整**：拖拽窗口边缘调整大小
- **最大化/还原**：双击标题栏或使用按钮
- **最小化**：最小化到任务栏

## 🐛 故障排除

### 常见问题

**Q: 图片功能不可用**
A: 需要安装Pillow库：`pip install Pillow`

**Q: 窗口无法调整大小**
A: 确保窗口未处于最大化状态，拖拽窗口边缘进行调整

**Q: 项目文件无法打开**
A: 检查文件格式是否为 `.rtep`，确保文件未损坏

**Q: 标签页内容丢失**
A: 确保在切换标签页前保存项目，避免意外关闭程序

### 性能优化
- 大量图片可能影响性能，建议适量使用
- 定期保存项目以避免数据丢失
- 关闭不需要的标签页以节省内存

## 📝 更新日志

### 当前版本特性
- ✅ 多标签页管理系统
- ✅ 项目统一保存/加载功能
- ✅ 图片插入和拖拽功能
- ✅ 自定义界面和强制置顶
- ✅ 富文本格式支持
- ✅ 语法高亮和行号显示
- ✅ 透明度控制
- ✅ 完整的快捷键支持

### 已修复问题
- 🔧 导入项目后第一个标签页内容丢失
- 🔧 保存项目后仍提示未保存更改
- 🔧 图片保存/导入功能异常
- 🔧 嵌入式图片无法正确恢复
- 🔧 标签页修改状态管理问题

## 🤝 贡献指南

### 代码结构
- 主要代码位于 `main.py`
- 采用面向对象设计，单一类结构
- 功能模块化，便于维护和扩展

### 开发环境
1. Python 3.6+
2. 推荐使用虚拟环境
3. 安装开发依赖：`pip install Pillow`

### 贡献方式
1. Fork项目
2. 创建功能分支
3. 提交更改
4. 发起Pull Request

## 📄 许可证

本项目采用开源许可证，欢迎自由使用、修改和分发。

## 📞 联系方式

如有问题或建议，欢迎通过以下方式联系：
- 提交Issue
- 发起Discussion
- 邮件联系

---

**缓冲编辑器** - 让文本编辑更高效，让创作更自由！